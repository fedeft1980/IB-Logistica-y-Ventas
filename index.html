<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>IB logÃ­stica y ventas</title>

  <style>
    :root { font-family: system-ui, Arial, sans-serif; }
    body { margin: 0; background:#f6f7f9; color:#111; }

    /* HEADER */
    header{
      background: #165C96;
      color:#fff;
      padding:16px;
      position:sticky;
      top:0;
      z-index:10;

      display:flex;
      flex-direction:column;
      align-items:center;
      text-align:center;
      gap:12px;
    }

    .logo {
      width: clamp(160px, 20vw, 240px);
      height:auto;
      border-radius:10px;
    }

    header h1 { margin:0; font-size:20px; }
    .muted { color:#cbd5e1; font-size:12px; }

    .topbar {
      display:flex;
      gap:8px;
      width:100%;
      max-width:700px;
      justify-content:center;
      align-items:center;
      flex-wrap:wrap;
    }

    .topbar input {
      flex:1;
      min-width: 180px;
      padding:10px;
      border:1px solid #cbd5e1;
      border-radius:10px;
    }

    .tag {
      background:#0ea5e9;
      color:#fff;
      padding:6px 10px;
      border-radius:999px;
      font-size:12px;
      display:flex;
      align-items:center;
      gap:6px;
      white-space:nowrap;
    }

    /* TAGS EXTRA */
    .tag-total { background:#22c55e; }

    .tag-btn {
      background:#e2e8f0;
      color:#0f172a;
      border:none;
      cursor:pointer;
      font-weight:700;
    }

    /* PRODUCTOS */
    main { padding:12px; }

    .grid {
      display:grid;
      grid-template-columns: repeat(auto-fill,minmax(180px,1fr));
      gap:12px;
    }

    .card {
      background:#fff;
      border-radius:14px;
      padding:12px;
      box-shadow:0 2px 8px rgba(0,0,0,.06);
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    .product-img {
      width:100%;
      height:140px;
      object-fit:cover;
      border-radius:10px;
      background:#e2e8f0;
    }

    .price { font-weight:700; }

    .row {
      display:flex;
      gap:6px;
      align-items:center;
    }

    .row button {
      width:32px;
      height:32px;
      border:none;
      border-radius:8px;
      background:#e2e8f0;
      font-size:18px;
      cursor:pointer;
    }

    .row input {
      width:56px;
      text-align:center;
      border:1px solid #cbd5e1;
      border-radius:8px;
      padding:6px;
    }

    /* CARRITO ABAJO */
    aside {
      position:sticky;
      bottom:0;
      background:#fff;
      border-top:1px solid #e5e7eb;
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:8px;
    }

    .btn {
      width:100%;
      padding:12px;
      border:none;
      border-radius:12px;
      font-size:16px;
      font-weight:700;
      cursor:pointer;
    }

    .btn-wsp { background:#22c55e; color:white; }
    .btn-clear { background:#f1f5f9; }

    /* MODAL */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,.55);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
      z-index: 50;
    }

    .modal.hidden { display:none; }

    .modal-card {
      width: 100%;
      max-width: 520px;
      background: white;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,.2);
      overflow: hidden;
    }

    .modal-header {
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding: 14px 16px;
      background:#f1f5f9;
    }

    .modal-header h2 { margin:0; font-size:18px; }

    .close {
      border:none;
      background:transparent;
      font-size:18px;
      cursor:pointer;
    }

    .modal-items {
      max-height: 55vh;
      overflow:auto;
      padding: 10px 16px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    .modal-item {
      display:flex;
      justify-content:space-between;
      align-items:center;
      border-bottom:1px dashed #e5e7eb;
      padding-bottom:8px;
    }

    .modal-item .name { font-weight:600; }
    .modal-item .sub { color:#64748b; font-size:13px; }

    .modal-footer {
      padding: 12px 16px 16px;
      border-top:1px solid #e5e7eb;
      display:flex;
      flex-direction:column;
      gap:8px;
    }

    .modal-total {
      font-size:18px;
      font-weight:800;
      text-align:right;
    }
  </style>
</head>

<body>

  <!-- HEADER -->
  <header>
    <img src="ivan.jpeg" class="logo" alt="logo">
    <h1>ðŸ§€ CatÃ¡logo Mayorista â€” LÃ¡cteos</h1>
    <div class="muted">SeleccionÃ¡ cantidades y enviÃ¡ el pedido por WhatsApp</div>

    <div class="topbar">
      <input id="search" placeholder="Buscar producto..." />
      <span class="tag" id="countTag">0 items</span>
      <span class="tag tag-total" id="totalTag">$ 0</span>
      <button class="tag tag-btn" id="viewCartBtn">Ver pedido</button>
    </div>
  </header>

  <!-- PRODUCTOS -->
  <main>
    <div id="productGrid" class="grid"></div>
  </main>

  <!-- CARRITO SIMPLE ABAJO -->
  <aside>
    <button class="btn btn-wsp" id="sendBtn">Enviar pedido por WhatsApp</button>
    <button class="btn btn-clear" id="clearBtn">Vaciar selecciÃ³n</button>
  </aside>

  <!-- MODAL RESUMEN PEDIDO -->
  <div id="cartModal" class="modal hidden">
    <div class="modal-card">
      <div class="modal-header">
        <h2>ðŸ§¾ Tu pedido</h2>
        <button id="closeModal" class="close">âœ•</button>
      </div>

      <div id="cartItems" class="modal-items"></div>

      <div class="modal-footer">
        <div class="modal-total">
          Total: <span id="modalTotal">$ 0</span>
        </div>
        <button class="btn btn-wsp" id="modalSendBtn">Enviar por WhatsApp</button>
        <button class="btn btn-clear" id="modalClearBtn">Vaciar selecciÃ³n</button>
      </div>
    </div>
  </div>

<script>
  const PRODUCTS = [
    { id: 1, name: "Leche Entera 1L", price: 1250, image: "ivan.jpeg" },
    { id: 2, name: "Leche Descremada 1L", price: 1230, image: "5.png" },
    { id: 3, name: "Yogur Bebible Frutilla 900g", price: 1750, image: "6.png" },
    { id: 4, name: "Yogur Firme Vainilla 190g", price: 420, image: "7.png" },
    { id: 5, name: "Queso Cremoso x Kg", price: 6900, image: "8.png" },
    { id: 6, name: "Manteca 200g", price: 2400, image: "9.png" },
    { id: 7, name: "Crema de Leche 200ml", price: 1300, image: "2.png" },
    { id: 8, name: "Dulce de Leche 400g", price: 1600, image: "3.png" },
  ];

  const productGrid = document.getElementById("productGrid");
  const search = document.getElementById("search");
  const sendBtn = document.getElementById("sendBtn");
  const clearBtn = document.getElementById("clearBtn");
  const countTag = document.getElementById("countTag");
  const totalTag = document.getElementById("totalTag");
  const viewCartBtn = document.getElementById("viewCartBtn");

  // Modal refs
  const cartModal = document.getElementById("cartModal");
  const closeModal = document.getElementById("closeModal");
  const cartItems = document.getElementById("cartItems");
  const modalTotal = document.getElementById("modalTotal");
  const modalSendBtn = document.getElementById("modalSendBtn");
  const modalClearBtn = document.getElementById("modalClearBtn");

  let cart = {};

  function money(n) { return "$ " + n.toLocaleString("es-AR"); }

  function getFilteredProducts(){
    const q = search.value.toLowerCase().trim();
    return PRODUCTS.filter(p => p.name.toLowerCase().includes(q));
  }

  function calcTotals() {
    let items = 0;
    let total = 0;
    PRODUCTS.forEach(p => {
      const qty = cart[p.id] || 0;
      items += qty;
      total += qty * p.price;
    });
    return { items, total };
  }

  function updateHeader(){
    const { items, total } = calcTotals();
    countTag.textContent = `${items} item${items !== 1 ? "s" : ""}`;
    totalTag.textContent = money(total);

    viewCartBtn.disabled = items === 0;
    viewCartBtn.style.opacity = items === 0 ? 0.6 : 1;
    viewCartBtn.style.cursor = items === 0 ? "not-allowed" : "pointer";
  }

  function renderProducts(list){
    productGrid.innerHTML = "";
    list.forEach(p => {
      const qty = cart[p.id] || 0;
      const card = document.createElement("div");
      card.className = "card";

      card.innerHTML = `
        <img src="${p.image}" class="product-img" alt="${p.name}">
        <h3>${p.name}</h3>
        <div class="price">${money(p.price)}</div>
        <div class="row">
          <button class="dec">âˆ’</button>
          <input class="qty" value="${qty}" min="0" type="number" inputmode="numeric">
          <button class="inc">+</button>
        </div>
      `;

      const dec = card.querySelector(".dec");
      const inc = card.querySelector(".inc");
      const input = card.querySelector(".qty");

      inc.onclick = () => updateQty(p.id, (cart[p.id] || 0) + 1);
      dec.onclick = () => updateQty(p.id, Math.max(0, (cart[p.id] || 0) - 1));

      input.onchange = () => {
        const raw = parseInt(input.value || "0", 10);
        const safeQty = isNaN(raw) ? 0 : Math.max(0, raw);
        updateQty(p.id, safeQty);
      };

      productGrid.appendChild(card);
    });
  }

  function updateQty(id, qty){
    if (qty <= 0) delete cart[id];
    else cart[id] = qty;

    updateHeader();
    renderProducts(getFilteredProducts());
    renderCartModal(); // refresca modal si estÃ¡ abierto
  }

  function renderCartModal(){
    const { items, total } = calcTotals();
    modalTotal.textContent = money(total);

    if(items === 0){
      cartItems.innerHTML = `<div class="muted">No hay productos seleccionados.</div>`;
      return;
    }

    cartItems.innerHTML = "";
    PRODUCTS.forEach(p => {
      const qty = cart[p.id];
      if(!qty) return;
      const subtotal = qty * p.price;

      const row = document.createElement("div");
      row.className = "modal-item";
      row.innerHTML = `
        <div>
          <div class="name">${p.name}</div>
          <div class="sub">${qty} x ${money(p.price)}</div>
        </div>
        <div class="price">${money(subtotal)}</div>
      `;
      cartItems.appendChild(row);
    });
  }

  function buildWhatsAppMsg(){
    let msg = "ðŸ§€ *PEDIDO MAYORISTA*\\n\\n";
    let total = 0;

    PRODUCTS.forEach(p => {
      if (cart[p.id]) {
        const subtotal = p.price * cart[p.id];
        total += subtotal;
        msg += `â€¢ ${p.name} x ${cart[p.id]} â€” ${money(subtotal)}\\n`;
      }
    });

    msg += `\\n----------------------\\n`;
    msg += `*TOTAL: ${money(total)}*`;
    return msg;
  }

  function sendWhatsApp(){
    if (Object.keys(cart).length === 0) return alert("SeleccionÃ¡ algÃºn producto.");
    const msg = buildWhatsAppMsg();
    const url = "https://wa.me/5492657219585?text=" + encodeURIComponent(msg);
    window.open(url, "_blank");
  }

  // Buscar
 	search.oninput = () => renderProducts(getFilteredProducts());

  // Vaciar
  clearBtn.onclick = () => {
    cart = {};
    updateHeader();
    renderProducts(PRODUCTS);
    renderCartModal();
  };

  // Enviar
  sendBtn.onclick = sendWhatsApp;

  // Modal open/close
  viewCartBtn.onclick = () => {
    renderCartModal();
    cartModal.classList.remove("hidden");
  };
  closeModal.onclick = () => cartModal.classList.add("hidden");
  cartModal.onclick = (e) => {
    if(e.target === cartModal) cartModal.classList.add("hidden");
  };

  modalSendBtn.onclick = sendWhatsApp;
  modalClearBtn.onclick = clearBtn.onclick;

  // Init
  updateHeader();
  renderProducts(PRODUCTS);
</script>

</body>
</html>
